$(document).ready(function(){if(uploadWidget.length>0){uploadWidget.pluploadQueue(uploadOptions);var a=uploadWidget.pluploadQueue();a.bind("Init",function(b,c){debug("Runtime: "+c.runtime)});a.bind("FilesAdded",function(b,c){debug("FilesAdded event fired")});a.bind("QueueChanged",function(d,b){debug("QueueChanged event fired");if(checkTotalUploadSize(d)){var c=$("#fileList");c.html("");$.each(d.files,function(f,e){c.append('<input type="hidden" name="state.TempFiles['+f+']" value="'+e.name+'" />')})}else{return false}});a.bind("Error",function(b,c){handleError(b,c);turnStepActionButtonOn(true)});catalogUploadForm.submit(function(d){var c=$(wizardUploadWidgetId).pluploadQueue();if(c.total.uploaded==0){var b=$("#minimumFiles").val();b=b!=null?b:0;if(c.files.length>=b){if(c.files.length>0){if(!checkTotalUploadSize(c)){d.preventDefault();return}c.bind("FileUploaded",function(g,e,f){submitUploadFormWhenFilesDone(g)});c.bind("Error",function(e,f){handleError(e,f);$.prettyLoader.hide();turnStepActionButtonOn(true)});d.preventDefault();$.prettyLoader.show();c.start();turnStepActionButtonOn(false)}}else{d.preventDefault();feedback("info","Please select at least "+b+pluralize(" file",b)+" to upload.")}}})}});var wizardUploadWidgetId="#wizardUploader";var uploadLinkClass=".cw-media-upload";var audioFileFilter={title:"Audio files",extensions:"mp3"};var uploadWidget=$(wizardUploadWidgetId);var catalogUploadForm=$("#catalogUploadForm");var catalogFormIsSubmitted=false;var uploadOptions={runtimes:"gears,html5,flash,silverlight",url:"/CatalogUpload/UserMediaUpload",max_file_size:"20mb",chunk_size:"1mb",filters:[audioFileFilter],flash_swf_url:"/public/flash/plupload.flash.swf",silverlight_xap_url:"/public/flash/plupload.silverlight.xap"};function turnStepActionButtonOn(a){if(a){$("#stepAction").removeAttr("disabled")}else{$("#stepAction").attr("disabled","true")}}function submitUploadFormWhenFilesDone(a){var b=0;$.each(a.files,function(d,c){b+=a.files[d].status==plupload.DONE});if(b==a.files.length){debug("catalogUploadForm submit at done = "+b);catalogUploadForm.submit()}}function checkTotalUploadSize(a){var e=parseInt($("#maxFiles").val());var f=parseInt($("#maxBytes").val());var c=0;var d=a.files;$.each(d,function(h,g){c+=g.size});if(d.length>e){var b="You may only upload a total number of "+e+" files (you added "+d.length+" files)";feedback("warning",b);return false}else{if(c>f){var b="Total file size is more than "+toFileSizeDescription(f)+" ("+toFileSizeDescription(c)+"). If you have a slow upload link, this may take a long time and may time out.";feedback("info",b);return true}}return true}function handleError(a,b){if(b!=null){switch(b.code){case plupload.FILE_SIZE_ERROR:feedback("info","Please upload audio files smaller than "+toFileSizeDescription(a.settings.max_file_size)+" only.");break;case plupload.FILE_EXTENSION_ERROR:feedback("info","Please upload audio files in MP3 format only.");break;default:feedback("error","There was an trying to upload your file ("+b.message+")")}}}var _mediaUploaders=new Array();function resetUploaders(){_mediaUploaders=new Array()}function setupMediaUploader(e,f,d,a,b){var c=new plupload.Uploader({runtimes:"gears,html5,flash,silverlight",url:"/CatalogUpload/UserMediaUpload?mediaVersion="+a,max_file_size:"20mb",chunk_size:"1mb",container:e,browse_button:f,filters:[{title:"Audio files",extensions:"mp3"}],flash_swf_url:"/public/flash/plupload.flash.swf",silverlight_xap_url:"/public/flash/plupload.silverlight.xap"});var d=$("#"+d);c.bind("Init",function(g,h){});c.bind("FilesAdded",function(g,h){$.each(h,function(k,j){debug("FilesAdded: "+j.name)})});c.bind("QueueChanged",function(k){debug("QueueChanged "+k.files.length);if(k.files.length>1){for(var h=0;h<k.files.length-1;h++){var j=k.files[h];k.removeFile(j);debug("Removed "+j.name)}}d.html("");if(k.files.length>0){var j=k.files[0];var g=j.name;d.html("<label>New file: </label><br/><label><strong>"+g+"</strong></label>");$("#uploadFiles_"+b+"_FileName").val(j.name)}k.start()});c.bind("FileUploaded",function(i,g,h){debug("FileUploaded event fired")});c.bind("StateChanged",function(i,g,h){debug("StateChanged: "+i.total.queued+" queued, "+i.total.uploaded+" uploaded")});c.bind("Error",function(g,h){d.html("");handleError(g,h)});c.bind("Init",function(g,h){debug("Runtime: "+h.runtime)});c.init();_mediaUploaders[b]=c};